CREATE TABLE CLIENTES
(
	COD_CLIENTE NUMERIC(18,0) IDENTITY(1,1) PRIMARY KEY NOT NULL,
	RG VARCHAR(9) NOT NULL,
	NOME VARCHAR(50) NOT NULL,
	ENDERECO VARCHAR(50) NULL,
	BAIRRO VARCHAR(30) NULL,
	CIDADE VARCHAR(30) NULL, 
	ESTADO CHAR(2) NOT NULL,
	TELEFONE VARCHAR(15) NULL,
	EMAIL VARCHAR(30) NULL,
	DATANASCIMENTO DATETIME NULL,
	sexo char(1)
)

CREATE TABLE CATEGORIA
(
	COD_CATEGORIA NUMERIC(10,0) IDENTITY(1,1) PRIMARY KEY NOT NULL,
	NOME_CATEGORIA VARCHAR(20) NOT NULL,
)

CREATE TABLE FILME
(
	COD_FILME NUMERIC(18,0) IDENTITY(1,1) PRIMARY KEY NOT NULL,
	FILME VARCHAR(30) NOT NULL,
	COD_CATEGORIA NUMERIC(10,0) NOT NULL,
	DIRETOR VARCHAR(50) NOT NULL,
	VALOR_LOCACAO FLOAT NOT NULL,
	RESERVADA CHAR(1) NOT NULL
)

CREATE TABLE LOCACOES
(
	COD_LOCACAO NUMERIC(18,0) IDENTITY(1,1) NOT NULL,
	COD_CLIENTE NUMERIC(18,0) NOT NULL,
	COD_FILME NUMERIC(18,0) NOT NULL,
	DATA_RETIRADA DATETIME NOT NULL,
	DATA_DEVOLUCAO DATETIME NULL,
	CONSTRAINT PK_LOCACAO_CLIENTE PRIMARY KEY(COD_LOCACAO, COD_CLIENTE, COD_FILME)
)

--CRIAÇÃO DOS RELACIONAMENTOS 
--LOCACAO - CLIENTES
ALTER TABLE LOCACOES WITH CHECK ADD CONSTRAINT FK_LOCACOES_CLIENTE FOREIGN KEY (COD_CLIENTE)
REFERENCES CLIENTES(COD_CLIENTE)


ALTER TABLE LOCACOES CHECK CONSTRAINT FK_LOCACOES_CLIENTE 



-- LOCACOES - FILME
ALTER TABLE LOCACOES WITH CHECK ADD CONSTRAINT FK_LOCACOES_FILME FOREIGN KEY (COD_FILME)
REFERENCES FILME(COD_FILME)


ALTER TABLE LOCACOES CHECK CONSTRAINT FK_LOCACOES_FILME 


--FILME - CATEGORIA
ALTER TABLE FILME WITH CHECK ADD CONSTRAINT FK_CATEGORIA_FILME FOREIGN KEY (COD_CATEGORIA)
REFERENCES CATEGORIA(COD_CATEGORIA)


ALTER TABLE FILME CHECK CONSTRAINT FK_CATEGORIA_FILME


-- INSERÇÕES NAS TABELAS
--categoria
INSERT INTO CATEGORIA VALUES ('Ação')
INSERT INTO CATEGORIA VALUES ('Romance')
INSERT INTO CATEGORIA VALUES ('Aventura')
INSERT INTO CATEGORIA VALUES ('Ficção')
INSERT INTO CATEGORIA VALUES ('Drama')
INSERT INTO CATEGORIA VALUES ('Terror')
INSERT INTO CATEGORIA VALUES ('Desenho')
INSERT INTO CATEGORIA VALUES ('Policial')
INSERT INTO CATEGORIA VALUES ('Comédia')

--clientes
INSERT INTO CLIENTES VALUES ('321346530', 'Edson Martin Feitosa', 'Rua Orlando Alvarenga, 1', 'Jd. Vera Cruz', 'Sorocaba', 'SP', '32125809', 'edson.feitosa@ig.com.br', '1982-11-02 00:00:00.000', 'M')
INSERT INTO CLIENTES VALUES ('421346111', 'Rafael Fernando de Moraes Moreno', 'Rua Francisco de Souza, 123', 'Jd. Nova Esperança', 'São Roque', 'SP', '32274567', 'rafael@terra.com.br', '1985-04-01 00:00:00.000', 'M')
INSERT INTO CLIENTES VALUES ('324857670', 'João da Silva', 'Rua Mario Quintana, 13', 'Av. Bartolomeu', 'Sorocaba', 'SP', '32134098', 'joao@uol.com.br', '1992-12-05 00:00:00.000', 'M')
INSERT INTO CLIENTES VALUES ('112345553', 'Maria Chiquinha', 'Rua Padre Luiz, 55', 'Jd. Vera Cruz', 'Sorocaba', 'SP', '23336684', 'maria@ig.com.br', '1982-10-11 00:00:00.000', 'F')
INSERT INTO CLIENTES VALUES ('945848768', 'Rafael Nunes Sales', 'Rua Orlando Alvarenga, 4', 'Jd. Vera Cruz', 'Sorocaba', 'SP', '32124609', 'rafael.sales@terra.com.br', '1985-04-01 00:00:00.000', 'M')
INSERT INTO CLIENTES VALUES ('676548499', 'Daniela Martin Feitosa', 'Rua Guilherme Oliveria, 1', 'Jd. Vera das Acássicas', 'Votorantim', 'SP', '32132109', 'daniela.martin@gmail.com', '1986-12-10 00:00:00.000', 'F')
INSERT INTO CLIENTES VALUES ('321349999', 'Renata Cristina', 'Rua Orlando Alvarenga, 1', 'Jd. Vera Cruz', 'Sorocaba', 'SP', '32125809', 'renata@gmail', '1970-09-01 00:00:00.000', 'F')
INSERT INTO CLIENTES VALUES ('335466531', 'Joaquim Ferreira de Souza Junior', 'Rua Outubro Vermelho, 65', 'Jd. Santa Rosália', 'Votorantim', 'SP', '11125809', 'joaquim_junior@ig.com.br', '1980-04-08 00:00:00.000', 'M')
INSERT INTO CLIENTES VALUES ('112233445', 'Ladislau Ferreira', 'Rua Orlando Alvarenga, 12345', 'Jd. Vera Cruz', 'Sorocaba', 'SP', '32144409', 'ladislau@terra.com.br', '1988-01-03 00:00:00.000', 'M')
INSERT INTO CLIENTES VALUES ('222222222', 'Vanessa Oliveira', 'Rua das Flores, 1', 'Jd. do Sol', 'Votorantim', 'SP', '32122222', 'vanessa@ig.com.br', '1998-08-08 00:00:00.000', 'F')

--filmes
INSERT INTO FILME VALUES ('300', 1, 'Richard Donner', 3.5, 'n')
INSERT INTO FILME VALUES ('Máquina Mortífera', 1, 'Richard Donner', 3.6, 'n')
INSERT INTO FILME VALUES ('A Mexicana', 2, 'Burr Steers', 2, 's')
INSERT INTO FILME VALUES ('A Verdade Nua e Crua', 2, 'Robert Luketic', 4, 'n')
INSERT INTO FILME VALUES ('A vida é bela', 2, 'Roberto Benigni', 3.5, 's')
INSERT INTO FILME VALUES ('Austrália', 3, 'Baz Luhrmann', 4, 's')
INSERT INTO FILME VALUES ('Ultimato Bourn', 3, 'Paul Greengrass', 3.5, 'n')
INSERT INTO FILME VALUES ('Constantine', 4, 'Francis Lawrence', 2.5, 's')
INSERT INTO FILME VALUES ('Os Irmãos Grimm', 4, 'Terry Gilliam', 3.5, 'n')
INSERT INTO FILME VALUES ('Os Doze Macacos', 4, 'Terry Gilliam', 2.5, 'n')
INSERT INTO FILME VALUES ('Amadeus', 5, 'Milos Forman', 10, 'n')
INSERT INTO FILME VALUES ('As Torres Gêmeas', 5, 'Oliver Stone', 2.5, 's')
INSERT INTO FILME VALUES ('Platoon', 1, 'Oliver Stone', 5.5, 's')
INSERT INTO FILME VALUES ('O Advogado do Diabo', 6, 'Taylor Hackford', 1.5, 's')
INSERT INTO FILME VALUES ('Beowulf', 7, 'Robert Zemeckis', 1, 'n')
INSERT INTO FILME VALUES ('Bolt o super cão', 7, 'Byron Howard', 1.5, 's')
INSERT INTO FILME VALUES ('Apertem o cinto o piloto sumiu', 9, 'Jim Abrahams', 3.6, 's')
INSERT INTO FILME VALUES ('Doze é demais', 9, 'Shawn Levy', 9.2, 's')
INSERT INTO FILME VALUES ('Uma noite no museu', 9, 'Shawn Levy', 2.5, 'n')

select * from filme
--Locações
INSERT INTO LOCACOES VALUES (1,1, '2010-03-10 19:05:43.887', '2010-03-10 00:00:00.000')
INSERT INTO LOCACOES VALUES (1,6, '2010-03-10 19:05:43.887', '2010-03-03 00:00:00.000')
INSERT INTO LOCACOES VALUES (1,8, '2010-03-10 19:05:43.887', '2010-03-03 00:00:00.000')
INSERT INTO LOCACOES VALUES (1,2, '2010-03-12 00:00:00.000', '2010-03-07 00:00:00.000')
INSERT INTO LOCACOES VALUES (1,13, '2010-03-12 00:00:00.000', '2010-03-07 00:00:00.000')
INSERT INTO LOCACOES VALUES (2,5, '2010-03-10 19:05:43.887', '2010-03-01 00:00:00.000')
INSERT INTO LOCACOES VALUES (3,3, '2010-03-08 19:05:43.887', '2010-03-10 00:00:00.000')
INSERT INTO LOCACOES VALUES (3,19, '2010-03-08 19:05:43.887', '2010-03-10 00:00:00.000')
INSERT INTO LOCACOES VALUES (4,17, '2010-03-01 19:05:43.887', '2010-03-03 00:00:00.000')
INSERT INTO LOCACOES VALUES (5,5, '2010-03-03 19:05:43.887', '2010-03-05 00:00:00.000')
INSERT INTO LOCACOES VALUES (6,7, '2010-03-03 19:05:43.887', '2010-03-04 00:00:00.000')
INSERT INTO LOCACOES VALUES (6,9, '2010-03-03 19:05:43.887', '2010-03-04 00:00:00.000')
INSERT INTO LOCACOES VALUES (7,16, '2010-03-03 19:05:43.887', '2010-03-05 00:00:00.000')
INSERT INTO LOCACOES VALUES (7,1, '2010-03-03 19:05:43.887', '2010-03-05 00:00:00.000')
INSERT INTO LOCACOES VALUES (7,5, '2010-03-04 19:05:43.887', '2010-03-06 00:00:00.000')
INSERT INTO LOCACOES VALUES (7,8, '2010-03-04 19:05:43.887', '2010-03-06 00:00:00.000')
INSERT INTO LOCACOES VALUES (7,11, '2010-03-04 19:05:43.887', '2010-03-06 00:00:00.000')
INSERT INTO LOCACOES VALUES (7,12, '2010-03-05 19:05:43.887', '2010-03-07 00:00:00.000')
INSERT INTO LOCACOES VALUES (8,9, '2010-03-10 19:05:43.887', '2010-03-01 00:00:00.000')
INSERT INTO LOCACOES VALUES (9,3, '2010-03-11 19:05:43.887', '2010-03-02 00:00:00.000')
INSERT INTO LOCACOES VALUES (9,6, '2010-03-11 19:05:43.887', '2010-03-02 00:00:00.000')
INSERT INTO LOCACOES VALUES (10,10, '2010-02-10 19:05:43.887', '2010-02-01 00:00:00.000')

select * from LOCACOES


/* [1] */
select * from CLIENTES

/* [2] */
select * from FILME

/* [3] */
select * from CATEGORIA

/* [4] */
select NOME, CIDADE, sexo
from CLIENTES
where sexo = 'M' and CIDADE = 'Sorocaba'

/* [5] */
select c.NOME, c.TELEFONE
from CLIENTES c
Order by NOME

/* [6] */
select COUNT(*)
from CLIENTES
where sexo = 'F'

/* [7] */
select f.FILME
from FILME f
order by FILME

/* [8] */
select f.FILME, f.DIRETOR, f.RESERVADA
from FILME f
where DIRETOR = 'Shawn Levy' and RESERVADA = 'n'

/* [9] */
select f.FILME
from FILME f
where f.VALOR_LOCACAO > 5

/* [10] */
select distinct f.DIRETOR
from FILME f

/* [11] */
select COUNT(*)
from FILME

/* [12] */
select MAX (VALOR_LOCACAO)
from FILME

/* [13] */
select f.FILME, c.NOME_CATEGORIA
from FILME f, CATEGORIA c
where c.NOME_CATEGORIA = 'Ação'

/* [14] */
select f.FILME, c.NOME_CATEGORIA, f.RESERVADA, f.VALOR_LOCACAO
from FILME f, CATEGORIA c
where c.NOME_CATEGORIA = 'Romance' and f.RESERVADA = 's' and f.VALOR_LOCACAO < 5 or c.NOME_CATEGORIA = 'Aventura' and f.RESERVADA = 's' and f.VALOR_LOCACAO < 5

/* [15]  where c.NOME = 'Renata Cristina' */
select c.NOME, f.FILME
from CLIENTES c
inner join LOCACOES l on c.Cod_Cliente = l.COD_CLIENTE
inner join FILME f on f.COD_FILME = l.COD_FILME
where c.NOME = 'Renata Cristina'

/* [16] */  
select c.NOME
from CLIENTES c
inner join LOCACOES l on c.COD_CLIENTE = l.COD_CLIENTE
inner join FILME f on f.COD_FILME = l.COD_FILME
group by c.NOME
having COUNT(*) > 3

/* [17] */
SELECT c.NOME AS Cliente,
       SUM(f.VALOR_LOCACAO) AS TotalGasto
FROM CLIENTES c
INNER JOIN LOCACOES l ON c.COD_CLIENTE = l.COD_CLIENTE
INNER JOIN FILME f ON f.COD_FILME = l.COD_FILME
WHERE c.NOME = 'Renata Cristina'
GROUP BY c.NOME;

/* [18] */
SELECT AVG(f.VALOR_LOCACAO) AS MediaValorLocacao
FROM LOCACOES l, FILME f;

/* [19] */
SELECT MIN(f.VALOR_LOCACAO) AS MenorValorLocacao
FROM FILME f;

select VALOR_LOCACAO from FILME

/* [20] */
SELECT c.NOME_CATEGORIA, COUNT(f.COD_FILME) AS QuantidadeFilmes
FROM CATEGORIA c
LEFT JOIN FILME f ON c.COD_CATEGORIA = f.COD_CATEGORIA
GROUP BY c.NOME_CATEGORIA;


